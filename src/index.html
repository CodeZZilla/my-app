<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Duck</title>
    <link rel="stylesheet" href="index.css"/>
</head>
<body>
<div class="wrapper" id="wrapper">
    <img id="duck" class="duck walking-duck large" src="assets/ducks/duck.png">
    <audio id="krik" preload="auto" src="krik.mp3"></audio>

    <div class="callout_wrapper callout_walking" id="callout">
        <div class="callout right callout-text" id="callout-text">Just google it!</div>
    </div>

</div>

<!--<script src="./preloadSettings.js"></script>-->
<script>
    let lang = 'en';
    let talkingDuck = true;
    let arrWithTextEng = [
        'Just google it.',
    ]
    let arrWithTextUkr = [
        'Просто загугли.',
    ]
    let ducks = [
        {name: 'simple', src: 'assets/ducks/duck.png'},
        {name: 'realistic', src: 'assets/ducks/duck_PNG5011.png'},
        {name: 'cool', src: 'assets/ducks/83e4a943664a198eb141cd46d6e36b21.png'},
        {name: 'lilalu1', src: 'assets/ducks/lilalu-quietscheente-al-capo-HR.png'},
        {name: 'lilalu2', src: 'assets/ducks/lilalu-quietscheente-barkeeper-rubber-duck-HR_436x436.png'},
        {name: 'paparazzi', src: 'assets/ducks/Paparazzi-Press-Media-Rubber-Duck-BudUSA-4__45420.1576269236.jpg'},
        {name: 'pixel', src: 'assets/ducks/pixel-yellow-duck-vector-21513825.jpg'},
        {name: 'unicorn', src: 'assets/ducks/png_transparent_unicorn_duck_rubber_duck_bath_toy_bridegroom_lilalu.png'},
        {name: 'piracy', src: 'assets/ducks/rubber_duck_piracy_natural_rubber_png_favpng_62gK31QvdbjEGxWBqaLRNJ06c.jpg'}
    ]
    let duckSize = 'large';


    let wrapper = document.getElementById('wrapper')
    let duck = document.getElementById('duck')
    let audio = document.getElementById("krik");
    let calloutText = document.getElementById('callout-text');
    let callout = document.getElementById('callout');
    audio.volume = .5
    wrapper.style.opacity = 1

    duck.addEventListener('click', () => {
        audio.play();
    })

    const {ipcRenderer} = require('electron')

    let setDuckImg = (mood) =>{
        for (let duckItem of ducks) {
            if(mood===duckItem.name){
                duck.src = duckItem.src;
            }
        }
    }

    let setWindowSize = () =>{
        let sizeWindow = {width: null, height: null};
        log.postMessage(talkingDuck);
        switch (duckSize){
            case 'small':{
                talkingDuck ? sizeWindow = {width: 235, height: 100} : sizeWindow = {width: 200, height: 100}
                setTimeout(()=>ipcRenderer.send("change-window-size", sizeWindow), 1000)
                break;
            }
            case 'medium':{
                talkingDuck ? sizeWindow = {width: 300, height: 150} : sizeWindow = {width: 260, height: 150}
                setTimeout(()=>ipcRenderer.send("change-window-size", sizeWindow), 1000)
                break;
            }
            case 'large':{
                talkingDuck ? sizeWindow = {width: 420, height: 200} : sizeWindow = {width: 330, height: 200}
                setTimeout(()=>ipcRenderer.send("change-window-size", sizeWindow), 1000)
                break;
            }
        }
    }

    let setDuckSize = (size) =>{
        duckSize = size;
        switch (size){
            case 'small':{
                if(duck.classList.contains('large')){
                    duck.classList.remove('large')
                    duck.classList.add('small')
                }else if(duck.classList.contains('medium')){
                    duck.classList.remove('medium')
                    duck.classList.add('small')
                }
                break;
            }
            case 'medium':{
                if(duck.classList.contains('large')){
                    duck.classList.remove('large')
                    duck.classList.add('medium')
                }else if(duck.classList.contains('small')){
                    duck.classList.remove('small')
                    duck.classList.add('medium')
                }
                break;
            }
            case 'large':{
                if(duck.classList.contains('medium')){
                    duck.classList.remove('medium')
                    duck.classList.add('large')
                }else if(duck.classList.contains('small')){
                    duck.classList.remove('small')
                    duck.classList.add('large')
                }
                break;
            }
        }
        setWindowSize();
    }

    ipcRenderer.on('save-settings', (event, data) => {
        let settings = JSON.parse(data)
        setDuckImg(settings.mood)

        lang = settings.language;
        setText(settings.language);

        audio.volume = settings.sound / 100
        wrapper.style.opacity = settings.opacity / 100

        talkingDuck = settings.talking;

        setDuckSize(settings.sizeMode);
    })
    callout.style.opacity = '0'

    let showCallout = () => {
        if (talkingDuck) {
            callout.style.opacity = '0'
            talkingDuck = false;
        } else {
            callout.style.opacity = '1';
            talkingDuck = true;
        }
        setWindowSize();
    }

    const channelImg = new BroadcastChannel("settingsImg");
    const channelSound = new BroadcastChannel("settingsSound");
    const channelOpacity = new BroadcastChannel("settingsOpacity");
    const channelLang = new BroadcastChannel("settingsLang");
    const channelWalkingDuck = new BroadcastChannel('channelWalkingDuck');
    const channelTalkingDuck = new BroadcastChannel('channelTalkingDuck');
    const channelSizeDuck = new BroadcastChannel('channelSizeDuck');
    const log = new BroadcastChannel('channelLog');

    channelWalkingDuck.onmessage = (event) =>{
        if(event.data){
            duck.classList.replace('non-walking', 'walking-duck')
            callout.classList.replace('non-walking', 'callout_walking')
        }else{
            duck.classList.replace('walking-duck', 'non-walking')
            callout.classList.replace('callout_walking', 'non-walking')
        }
    }

    channelImg.onmessage = (event) => {
        duck.src = event.data
    }

    channelSizeDuck.onmessage = (event) => {
        setDuckSize(event.data)
    }

    channelSound.onmessage = (event) => {
        audio.volume = event.data
        audio.play();
    }

    channelOpacity.onmessage = (event) => {
        wrapper.style.opacity = event.data
    }

    // setText(lang);
    channelLang.onmessage = (event) => {
        lang = event.data;
        setText(event.data);
    }

    channelTalkingDuck.onmessage = (e)=>{
        talkingDuck = e.data;
        setWindowSize()
    }


    const setText = (lang) => {
        console.log(lang)
        lang === 'en' ?
            calloutText.innerHTML = arrWithTextEng[Math.floor(Math.random() * arrWithTextEng.length)]
            :
            calloutText.innerHTML = arrWithTextUkr[Math.floor(Math.random() * arrWithTextUkr.length)];
    }

    // setInterval(() => {
    //     setText(lang)
    // }, 15000)


    setInterval(() => {
        if(talkingDuck){
            setText(lang)
            showCallout(lang)
            setTimeout(()=>{showCallout(lang)},10000)
        }
    }, 1500000)

</script>

</body>

</html>
