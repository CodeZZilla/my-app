<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Duck</title>
    <link rel="stylesheet" href="index.css"/>
</head>
<body>
<div class="wrapper">
    <img id="duck" class="duck" src="assets/ducks/duck.png" ondblclick="showCallout()">
    <audio id="krik" preload="auto" src="krik.mp3"></audio>

    <div class="callout_wrapper" id="callout">
        <div class="callout right callout-text" id="callout-text">Your Favourite HTML,CSS,JS Playground!</div>
    </div>

</div>

<!--<script src="./preloadSettings.js"></script>-->
<script>
    let lang = 'en';
    let duck = document.getElementById('duck')
    let audio = document.getElementById("krik");
    let calloutText = document.getElementById('callout-text');
    let callout = document.getElementById('callout');
    audio.volume = .5

    duck.addEventListener('click', () => {
        audio.play();
    })

    const {ipcRenderer} = require('electron')

    ipcRenderer.on('save-settings', (event, data) => {
        let settings = JSON.parse(data)
        switch (settings.mood) {
            case "standart":
                duck.src = "assets/ducks/duck.png";
                break;
            case "realistic":
                duck.src = "assets/ducks/duck_PNG5011.png";
                break;
            case "cool":
                duck.src = "assets/ducks/83e4a943664a198eb141cd46d6e36b21.png";
                break;
        }

        lang = settings.language;
        setText(settings.language);

        audio.volume = settings.sound / 100
    })

    let showCallout = () => {
        let sizeInt = 0;
        if (callout.style.opacity === '1') {
            callout.style.opacity = '0'
            sizeInt = 300
        } else {
            callout.style.opacity = '1';
            sizeInt = 500
        }
        ipcRenderer.send("show-callout", {size: sizeInt});
    }

    const channelImg = new BroadcastChannel("settingsImg");
    const channelSound = new BroadcastChannel("settingsSound");
    const channelLang = new BroadcastChannel("settingsLang");


    channelImg.onmessage = (event) => {
        duck.src = event.data
    }

    channelSound.onmessage = (event) => {
        audio.volume = event.data
        audio.play();
    }


    let arrWithTextEng = [
        'Normal people plant trees, and programmers build and bypass them.',
        'There are 10 types of people: who understand the binary number system and do not understand.',
        'At the World Women\'s Logic Championship was won by the generalist of number sequences with a big ret.',
        'Folk sign: If the program is at 09.00 in the morning at work, then he slept there...',
        'A real programmer to the question: - "Could you do it..." He\'ll answer, "YES," and then he\'ll think about how.'
    ]
    let arrWithTextUkr = [
        'Нормальні люди садять дерева, а програмісти будують і обходять їх.',
        'Є 10 типів людей: які розуміють двійкову систему числення і не розуміють.',
        'На чемпіонаті світу з логіки серед жінок виграла універсал із числових послідовностей з великим відривом.',
        'Народна прикмета: Якщо програміст о 09.00 ранку на роботі, значить, він там спав...',
        'Справжній програміст на запитання: «Чи не могли б ви це зробити...» Він відповість «ТАК», а потім подумає, як.'
    ]

    calloutText.innerHTML = arrWithTextEng[Math.floor(Math.random() * arrWithTextEng.length)];

    // setText(lang);
    channelLang.onmessage = (event) => {
        lang = event.data;
        setText(event.data);
    }

    const setText = (lang) => {
        lang === 'en' ?
            calloutText.innerHTML = arrWithTextEng[Math.floor(Math.random() * arrWithTextEng.length)]
            :
            calloutText.innerHTML = arrWithTextUkr[Math.floor(Math.random() * arrWithTextUkr.length)];
    }

    setInterval(() => {
        setText(lang)
    }, 15000)
</script>

</body>

</html>
