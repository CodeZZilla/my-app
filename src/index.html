<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Duck</title>
    <link rel="stylesheet" href="index.css"/>
</head>
<body>
<div class="wrapper" id="wrapper">
    <img id="duck" class="duck walking-duck" src="assets/ducks/duck.png">
    <audio id="krik" preload="auto" src="krik.mp3"></audio>

    <div class="callout_wrapper callout_walking" id="callout">
        <div class="callout right callout-text" id="callout-text">Just google it!</div>
    </div>

</div>

<!--<script src="./preloadSettings.js"></script>-->
<script>
    let lang = 'en';
    let talkingDuck = true;
    let arrWithTextEng = [
        'Just google it.',
    ]
    let arrWithTextUkr = [
        'Просто загугли.',
    ]

    let wrapper = document.getElementById('wrapper')
    let duck = document.getElementById('duck')
    let audio = document.getElementById("krik");
    let calloutText = document.getElementById('callout-text');
    let callout = document.getElementById('callout');
    audio.volume = .5
    wrapper.style.opacity = 1

    duck.addEventListener('click', () => {
        audio.play();
    })

    const {ipcRenderer} = require('electron')

    ipcRenderer.on('save-settings', (event, data) => {
        let settings = JSON.parse(data)
        switch (settings.mood) {
            case "standart":
                duck.src = "assets/ducks/duck.png";
                break;
            case "realistic":
                duck.src = "assets/ducks/duck_PNG5011.png";
                break;
            case "cool":
                duck.src = "assets/ducks/83e4a943664a198eb141cd46d6e36b21.png";
                break;
        }

        lang = settings.language;
        setText(settings.language);

        audio.volume = settings.sound / 100
        wrapper.style.opacity = settings.opacity / 100

        talkingDuck = settings.talking;


    })
    callout.style.opacity = '0'

    let showCallout = () => {
        let sizeInt = 0;
        if (callout.style.opacity === '1') {
            callout.style.opacity = '0'
            sizeInt = 300
        } else {
            callout.style.opacity = '1';
            sizeInt = 415
        }
        ipcRenderer.send("show-callout", {size: sizeInt});
    }

    const channelImg = new BroadcastChannel("settingsImg");
    const channelSound = new BroadcastChannel("settingsSound");
    const channelOpacity = new BroadcastChannel("settingsOpacity");
    const channelLang = new BroadcastChannel("settingsLang");
    const channelWalkingDuck = new BroadcastChannel('channelWalkingDuck');
    const channelTalkingDuck = new BroadcastChannel('channelTalkingDuck');

    channelWalkingDuck.onmessage = (event) =>{
        if(event.data){
            duck.className = 'duck walking-duck'
            callout.className = 'callout_wrapper callout_walking'
        }else{
            duck.className = 'duck non-walking'
            callout.className = 'callout_wrapper non-walking'
        }
    }

    channelImg.onmessage = (event) => {
        duck.src = event.data
    }

    channelSound.onmessage = (event) => {
        audio.volume = event.data
        audio.play();
    }

    channelOpacity.onmessage = (event) => {
        wrapper.style.opacity = event.data
    }

    // setText(lang);
    channelLang.onmessage = (event) => {
        lang = event.data;
        setText(event.data);
    }

    channelTalkingDuck.onmessage = (e)=>{
        talkingDuck = e.data;
    }

    const setText = (lang) => {
        console.log(lang)
        lang === 'en' ?
            calloutText.innerHTML = arrWithTextEng[Math.floor(Math.random() * arrWithTextEng.length)]
            :
            calloutText.innerHTML = arrWithTextUkr[Math.floor(Math.random() * arrWithTextUkr.length)];
    }

    // setInterval(() => {
    //     setText(lang)
    // }, 15000)


    setInterval(() => {
        if(talkingDuck){
            setText(lang)
            showCallout(lang)
            setTimeout(()=>{showCallout(lang)},10000)
        }
    }, 1500000)

</script>

</body>

</html>
