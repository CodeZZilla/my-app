<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="settings.css">
    <title>Title</title>
</head>
<body class="p-auto-dark-mode p-layout default">
<div class=" p-modal-background wrapper">
    <div class="header">
        <div class="header-title">
            <img class="logo" src="assets/duck-icon.png" alt="">
            <h3 id="title">Duck Settings</h3>
        </div>
        <label class="switch">
            <input id="duck-view" type="checkbox" checked onchange="duckView(this)">
            <span class="slider round"></span>
        </label>
    </div>
    <div class="body__wrapper">
        <div class="body">

            <p id="mood-title">Mood</p>
            <div class="p-segmented-controls" id="mood">
                <a id="standart" onclick="setDuck(this)" href="#">Standart</a>
                <a id="realistic" onclick="setDuck(this)" href="#">Realistic</a>
                <a id="cool" onclick="setDuck(this)" href="#">Cool</a>
            </div>
            <hr>

            <p id="language-title">Language</p>
            <div class="p-segmented-controls">
                <a id="en" href="#" onclick="languageChange(this)">English</a>
                <a id="uk" href="#" onclick="languageChange(this)">Українська</a>
            </div>
            <hr>

            <p id="sound-title">Sound</p>
            <input id="sound" type="range" min="0" max="100" onchange="changeSound()" class="p-form-range">

            <button id="btn-donut" class="p-btn">Go to Web site</button>
        </div>
    </div>
</div>
<script>
    let title = document.getElementById('title')
    let moodTitle = document.getElementById('mood-title')
    let languageTitle = document.getElementById('language-title')
    let soundTitle = document.getElementById('sound-title')
    let btnDonut = document.getElementById('btn-donut')
    let standartBtn = document.getElementById('standart')
    let realisticBtn = document.getElementById('realistic')
    let coolBtn = document.getElementById('cool')


    const channelImg = new BroadcastChannel("settingsImg");
    const channelSound = new BroadcastChannel("settingsSound");
    const channelLang = new BroadcastChannel('settingsLang');

    const {ipcRenderer} = require('electron')

    let p_segmented_controls = document.querySelectorAll(".p-segmented-controls a");

    ipcRenderer.on('save-settings', (event, data) => {
        console.log(data)
        let settings = JSON.parse(data)
        document.getElementById('sound').value = Number(settings.sound)
        switch (settings.mood) {
            case "standart":
                standartBtn.classList.add('active')
                break
            case "realistic":
                realisticBtn.classList.add('active')
                break
            case "cool":
                coolBtn.classList.add('active')
                break
        }

        if (settings.language === 'uk') {
            document.getElementById('uk').classList.add('active')
            title.textContent = "Налаштування качки"
            moodTitle.textContent = "Настрій"
            languageTitle.textContent = "Мова"
            soundTitle.textContent = "Звук"
            btnDonut.textContent = "Перейти на сайт"
            standartBtn.textContent = "Стандартна"
            realisticBtn.textContent = "Реалістична"
            coolBtn.textContent = "Крута"
        } else if (settings.language === 'en') {
            document.getElementById('en').classList.add('active')
            title.textContent = "Duck Settings"
            moodTitle.textContent = "Mood"
            languageTitle.textContent = "Language"
            soundTitle.textContent = "Sound"
            btnDonut.textContent = "Go to Web site"
            standartBtn.textContent = "Standart"
            realisticBtn.textContent = "Realistic"
            coolBtn.textContent = "Cool"
        }
    });


    for (var item of p_segmented_controls) {
        item.addEventListener("click", function (event) {
            event.preventDefault();
            this.parentElement.querySelector("a.active").classList.remove("active");
            this.classList.add("active");
        });
    }

    let setDuck = (mood) => {
        switch (mood.id) {
            case "standart":
                ipcRenderer.send('change-mood-store', 'standart');
                channelImg.postMessage("assets/ducks/duck.png");
                break;
            case "realistic":
                ipcRenderer.send('change-mood-store', 'realistic');
                channelImg.postMessage("assets/ducks/duck_PNG5011.png");
                break;
            case "cool":
                ipcRenderer.send('change-mood-store', 'cool');
                channelImg.postMessage("assets/ducks/83e4a943664a198eb141cd46d6e36b21.png");
                break;
        }
    }

    let changeSound = () => {
        let element = document.getElementById('sound')
        ipcRenderer.send('change-sound-store', element.value);
        channelSound.postMessage(element.value / 100)
    }

    let duckView = (el) => {
        ipcRenderer.send("duck-window-status", JSON.stringify(true));
    }

    let languageChange = (element) => {
        channelLang.postMessage("settingsLang", element.id);
        ipcRenderer.send('change-language-store', element.id);
        if (element.id === 'uk') {
            title.textContent = "Налаштування качки"
            moodTitle.textContent = "Настрій"
            languageTitle.textContent = "Мова"
            soundTitle.textContent = "Звук"
            btnDonut.textContent = "Перейти на сайт"
            standartBtn.textContent = "Стандартна"
            realisticBtn.textContent = "Реалістична"
            coolBtn.textContent = "Крута"
        } else if (element.id === 'en') {
            title.textContent = "Duck Settings"
            moodTitle.textContent = "Mood"
            languageTitle.textContent = "Language"
            soundTitle.textContent = "Sound"
            btnDonut.textContent = "Go to Web site"
            standartBtn.textContent = "Standart"
            realisticBtn.textContent = "Realistic"
            coolBtn.textContent = "Cool"
        }
    }
</script>
</body>
</html>